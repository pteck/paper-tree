<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="paper-tree-node.html">
<!--
`<paper-tree>` display a browsable tree of nodes (`<paper-tree-node>`) with expandable/collapsible capabilities and actions menu for each node.

Example:

    <paper-tree></paper-tree>

@demo
-->

<style>

    .root-list {
        margin: 0;
        padding-left: 40px;
    }

</style>

<dom-module id="paper-tree">
    <template>
        <template is="dom-repeat" items="{{data.children}}">
                <paper-tree-node class="root-list" data="{{item}}"></paper-tree-node>
        </template>
    </template>

    <script>
        class PaperTree extends Polymer.Element {

            static get is() { return 'paper-tree'; }

            static get properties() {
                return {

                    /**
                     * Data hold by the root node (contains the children).
                     *
                     * Specific data:
                     *
                     * - `data.name`: string representing the node name.
                     * - `data.icon`: string telling which icon to use (default to 'folder' icon).
                     * - `data.open`: boolean telling whether the node is expanded or not.
                     * - `data.children` array containing the children of the node.
                     */
                    data: {
                        type: Object,
                        value: function () {
                            return null;
                        },
                        observer: "_dataChanged"
                    },

                    /**
                     * `selected` is the current selected `<paper-tree-node>` in the tree.
                     */
                    selected: {
                        type: Object,
                        value: null,
                        notify: true
                    },

                    selectedElement: {
                        type: Object,
                        value: null,
                        notify: true
                    },

                    toggled: {
                        type: Object,
                        value: null,
                        notify: true
                    }
                };
            }


            constructor() {
                super();
                
            }

            ready() {
                super.ready();
                this.addEventListener('select', e => this._selectNode(e));
                this.addEventListener('toggle', e => this._toggleNode(e));
            }        

            /**
             * Called whenever the data is changed to notify the lower nodes.
             */
            _dataChanged() {
//                this.$.root.data = this.data;
            };

            /**
             * Called when the `select` event is fired from an internal node.
             *
             * @param {object} e An event object.
             */
            _selectNode(e) {
                
                if (this.selectedElement) {
                    this.selectedElement.classList.toggle("selected", false);
                }

                // Only selects `<paper-tree-node>`.
                if (e.detail.element && e.detail.element.tagName === 'PAPER-TREE-NODE') {
                    this.selected = e.detail.selectedDetail;
                    this.selectedElement = e.detail.element;
                    this.selectedElement.classList.toggle("selected", true);
                } else {
                    this.selected = null;
                    this.selectedElement = null;
                }
            };

            _toggleNode(e) {
                // Only selects `<paper-tree-node>`.
                if (e.detail.element && e.detail.element.tagName === 'PAPER-TREE-NODE') {
                    this.toggled = e.detail.selectedDetail;
                } else {
                    this.toggled = null;
                }
            };

        };

        window.customElements.define(PaperTree.is, PaperTree);

    </script>

</dom-module>
